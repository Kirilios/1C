ВЫБРАТЬ
    НАЧАЛОПЕРИОДА(Реализация.Дата, ДЕНЬ) КАК Дата,
    Реализация.Контрагент КАК Контрагент,
    Реализация.ДоговорКонтрагента КАК ДоговорКонтрагента,
    Реализация.НоменклатурнаяГруппа КАК НоменклатурнаяГруппа,
    ЕСТЬNULL(СУММА(Реализация.РеализацияКоличество),0) КАК РеализацияКоличество,
    ЕСТЬNULL(СУММА(Реализация.РеализацияСумма),0) КАК РеализацияСумма,
    ЕСТЬNULL(СУММА(Факт.ФактКоличество),0) КАК ФактКоличество,
    ЕСТЬNULL(СУММА(Факт.ФактСумма),0) КАК ФактСумма,
    ЕСТЬNULL(СУММА(ВЫБОР
                     КОГДА КорректировкаУслуги.Количество>0
                     ТОГДА КорректировкаУслуги.Количество
                     ИНАЧЕ КорректировкаТовары.Количество
                  КОНЕЦ),0) КАК КорректировкаКоличество,
    ЕСТЬNULL(СУММА(ВЫБОР
                     КОГДА КорректировкаУслуги.Количество>0
                     ТОГДА КорректировкаУслуги.Сумма
                     ИНАЧЕ КорректировкаТовары.СуммаКорректировки
                  КОНЕЦ),0) КАК КорректировкаСумма
ИЗ
    (
        ВЫБРАТЬ
            Реализация.Дата,
            Реализация.Контрагент,
            Реализация.ДоговорКонтрагента,
            ЕСТЬNULL(РТУТовары.Субконто, РТУУслуг.Субконто) КАК НоменклатурнаяГруппа,
            СУММА(ВЫБОР
                    КОГДА ЕСТЬNULL(РТУТовары.Сумма,0)>0
                        ТОГДА ЕСТЬNULL(РТУТовары.Количество,0)
                    ИНАЧЕ 0
                КОНЕЦ + ЕСТЬNULL(РТУУслуг.Количество,0)) КАК РеализацияКоличество,
            СУММА(ЕСТЬNULL(РТУТовары.Сумма,0)+ЕСТЬNULL(РТУУслуг.Сумма,0)) КАК РеализацияСумма
        ИЗ
            Документ.РеализацияТоваровУслуг КАК Реализация
            ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Товары КАК РТУТовары
                ПО Реализация.Ссылка = РТУТовары.Ссылка
            ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Услуги КАК РТУУслуг
                ПО Реализация.Ссылка = РТУУслуг.Ссылка
        ГДЕ
            Реализация.Проведен
            И Реализация.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
            И Реализация.Склад.Наименование ПОДОБНО "%Склад отгрузки готовой продукции%"
            И СОКРЛ(СОКРП(Реализация.ПодразделениеОрганизации.Код))="53"
        СГРУППИРОВАТЬ ПО
            Реализация.Дата,
            Реализация.Контрагент,
            Реализация.ДоговорКонтрагента,
            ЕСТЬNULL(РТУТовары.Субконто, РТУУслуг.Субконто)
    ) КАК Реализация
    ЛЕВОЕ СОЕДИНЕНИЕ (
        ВЫБРАТЬ
            НАЧАЛОПЕРИОДА(ФактическиеДанные.Период, ДЕНЬ) КАК Дата,
            ФактическиеДанные.Контрагент,
            ФактическиеДанные.ДоговорКонтрагента,
            ФактическиеДанные.НоменклатурнаяГруппа,
            СУММА(ФактическиеДанные.Количество) КАК ФактКоличество,
            СУММА(ФактическиеДанные.Сумма) КАК ФактСумма
        ИЗ
            Документ.бит_ПолучениеФактическихДанных.ФактическиеДанные КАК ФактическиеДанные
        ГДЕ
            ФактическиеДанные.Ссылка.Проведен
            И ФактическиеДанные.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
            И ФактическиеДанные.Ссылка.Сценарий.Наименование="ФАКТ"
            И ФактическиеДанные.СтатьяОборотов.ТипСтатьи=ЗНАЧЕНИЕ(Перечисление.бит_ТипыСтатейОборотов.БДР)
        СГРУППИРОВАТЬ ПО
            НАЧАЛОПЕРИОДА(ФактическиеДанные.Период, ДЕНЬ),
            ФактическиеДанные.Контрагент,
            ФактическиеДанные.ДоговорКонтрагента,
            ФактическиеДанные.НоменклатурнаяГруппа
    ) КАК Факт
        ПО Реализация.Дата = Факт.Дата
            И Реализация.Контрагент = Факт.Контрагент
            И Реализация.ДоговорКонтрагента = Факт.ДоговорКонтрагента
            И Реализация.НоменклатурнаяГруппа = Факт.НоменклатурнаяГруппа
    ЛЕВОЕ СОЕДИНЕНИЕ (
        ВЫБРАТЬ
            Корректировка.Дата,
            Реализация.Контрагент,
            Реализация.ДоговорКонтрагента,
            КорректировкаТовары.НоменклатурнаяГруппа,
            КорректировкаТовары.Количество,
            КорректировкаТовары.СуммаКорректировки,
            КорректировкаУслуги.Количество,
            КорректировкаУслуги.Сумма
        ИЗ
            Документ.КорректировкаРеализации КАК Корректировка
            ЛЕВОЕ СОЕДИНЕНИЕ (
                ВЫБРАТЬ
                    Товары.Ссылка,
                    Товары.Субконто КАК НоменклатурнаяГруппа,
                    СУММА(Товары.Количество) КАК Количество,
                    СУММА(Товары.СуммаКорректировки) КАК СуммаКорректировки
                ИЗ Документ.КорректировкаРеализации.Товары КАК Товары
                СГРУППИРОВАТЬ ПО
                    Товары.Ссылка,
                    Товары.Субконто
            ) КАК КорректировкаТовары
                ПО Корректировка.Ссылка = КорректировкаТовары.Ссылка
            ЛЕВОЕ СОЕДИНЕНИЕ (
                ВЫБРАТЬ
                    Услуги.Ссылка,
                    СУММА(Услуги.Количество) КАК Количество,
                    СУММА(Услуги.Сумма) КАК Сумма
                ИЗ Документ.КорректировкаРеализации.Услуги КАК Услуги
                СГРУППИРОВАТЬ ПО Услуги.Ссылка
            ) КАК КорректировкаУслуги
                ПО Корректировка.Ссылка = КорректировкаУслуги.Ссылка
            ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК Реализация
                ПО Корректировка.ДокументРеализации = Реализация.Ссылка
        ГДЕ
            Корректировка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
    ) КАК Корректировка
        ПО Реализация.Дата = Корректировка.Дата
            И Реализация.Контрагент = Корректировка.Контрагент
            И Реализация.ДоговорКонтрагента = Корректировка.ДоговорКонтрагента
            И Реализация.НоменклатурнаяГруппа = Корректировка.НоменклатурнаяГруппа
СГРУППИРОВАТЬ ПО
    Дата,
    Контрагент,
    ДоговорКонтрагента,
    НоменклатурнаяГруппа
УПОРЯДОЧИТЬ ПО
    Дата,
    Контрагент,
    ДоговорКонтрагента,
    НоменклатурнаяГруппа
