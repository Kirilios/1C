ВЫБРАТЬ
    Ключи.Дата,
    Ключи.Контрагент,
    Ключи.ДоговорКонтрагента,
    Ключи.НоменклатурнаяГруппа,

    ЕСТЬNULL(Реализация.РеализацияКоличество,0) КАК РеализацияКоличество,
    ЕСТЬNULL(Реализация.РеализацияСумма,0)       КАК РеализацияСумма,

    ЕСТЬNULL(Факт.ФактКоличество,0)              КАК ФактКоличество,
    ЕСТЬNULL(Факт.ФактСумма,0)                   КАК ФактСумма,

    ЕСТЬNULL(Корректировка.КоррКоличество,0)     КАК КорректировкаКоличество,
    ЕСТЬNULL(Корректировка.КоррСумма,0)          КАК КорректировкаСумма

ИЗ
    // -----------------------------
    // 1. Универсальный набор ключей
    // -----------------------------
    (ВЫБРАТЬ
         Дата,
         Контрагент,
         ДоговорКонтрагента,
         НоменклатурнаяГруппа
     ИЗ
        (
            ВЫБРАТЬ
                НАЧАЛОПЕРИОДА(Реализация.Дата,ДЕНЬ) КАК Дата,
                Реализация.Контрагент,
                Реализация.ДоговорКонтрагента,
                ЕСТЬNULL(РТУТовары.Субконто,РТУУслуг.Субконто) КАК НоменклатурнаяГруппа
            ИЗ Документ.РеализацияТоваровУслуг КАК Реализация
                ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Товары КАК РТУТовары
                    ПО Реализация.Ссылка = РТУТовары.Ссылка
                ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Услуги КАК РТУУслуг
                    ПО Реализация.Ссылка = РТУУслуг.Ссылка
            ГДЕ
                Реализация.Проведен
            ОБЪЕДИНИТЬ ВСЕ
            ВЫБРАТЬ
                НАЧАЛОПЕРИОДА(ФактическиеДанные.Период,ДЕНЬ) КАК Дата,
                ФактическиеДанные.Контрагент,
                ФактическиеДанные.ДоговорКонтрагента,
                ФактическиеДанные.НоменклатурнаяГруппа
            ИЗ Документ.бит_ПолучениеФактическихДанных.ФактическиеДанные КАК ФактическиеДанные
            ГДЕ
                ФактическиеДанные.Ссылка.Проведен
            ОБЪЕДИНИТЬ ВСЕ
            ВЫБРАТЬ
                НАЧАЛОПЕРИОДА(Корректировка.Дата,ДЕНЬ) КАК Дата,
                Корректировка.Контрагент,
                Корректировка.ДоговорКонтрагента,
                ЕСТЬNULL(КорректировкаТовары.НоменклатурнаяГруппа,КорректировкаУслуги.НоменклатурнаяГруппа) КАК НоменклатурнаяГруппа
            ИЗ Документ.КорректировкаРеализации КАК Корректировка
                ЛЕВОЕ СОЕДИНЕНИЕ 
                    (ВЫБРАТЬ
                         Товары.Ссылка,
                         Товары.Субконто КАК НоменклатурнаяГруппа,
                         СУММА(Товары.Количество) КАК Количество,
                         СУММА(Товары.Сумма) КАК Сумма
                     ИЗ Документ.КорректировкаРеализации.Товары КАК Товары
                     СГРУППИРОВАТЬ ПО Товары.Ссылка,Товары.Субконто
                    ) КАК КорректировкаТовары
                    ПО Корректировка.Ссылка = КорректировкаТовары.Ссылка
                ЛЕВОЕ СОЕДИНЕНИЕ
                    (ВЫБРАТЬ
                         Услуги.Ссылка,
                         СУММА(Услуги.Количество) КАК Количество,
                         СУММА(Услуги.Сумма) КАК Сумма,
                         Услуги.НоменклатурнаяГруппа
                     ИЗ Документ.КорректировкаРеализации.Услуги КАК Услуги
                     СГРУППИРОВАТЬ ПО Услуги.Ссылка, Услуги.НоменклатурнаяГруппа
                    ) КАК КорректировкаУслуги
                    ПО Корректировка.Ссылка = КорректировкаУслуги.Ссылка
        ) КАК Src
     СГРУППИРОВАТЬ ПО
         Src.Дата,
         Src.Контрагент,
         Src.ДоговорКонтрагента,
         Src.НоменклатурнаяГруппа
    ) КАК Ключи

// -----------------------------
// ЛЕВОЕ соединение агрегатов
// -----------------------------
ЛЕВОЕ СОЕДИНЕНИЕ
(ВЫБРАТЬ
    НАЧАЛОПЕРИОДА(Реализация.Дата,ДЕНЬ) КАК Дата,
    Реализация.Контрагент,
    Реализация.ДоговорКонтрагента,
    ЕСТЬNULL(РТУТовары.Субконто,РТУУслуг.Субконто) КАК НоменклатурнаяГруппа,
    СУММА(ВЫБОР
             КОГДА ЕСТЬNULL(РТУТовары.Сумма,0)>0 ТОГДА ЕСТЬNULL(РТУТовары.Количество,0) ИНАЧЕ 0 КОНЕЦ
         + ЕСТЬNULL(РТУУслуг.Количество,0)) КАК РеализацияКоличество,
    СУММА(ЕСТЬNULL(РТУТовары.Сумма,0)+ЕСТЬNULL(РТУУслуг.Сумма,0)) КАК РеализацияСумма
 FROM Документ.РеализацияТоваровУслуг КАК Реализация
     ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Товары КАК РТУТовары
         ПО Реализация.Ссылка = РТУТовары.Ссылка
     ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Услуги КАК РТУУслуг
         ПО Реализация.Ссылка = РТУУслуг.Ссылка
 WHERE
     Реализация.Проведен
 GROUP BY
     НАЧАЛОПЕРИОДА(Реализация.Дата,ДЕНЬ),
     Реализация.Контрагент,
     Реализация.ДоговорКонтрагента,
     ЕСТЬNULL(РТУТовары.Субконто,РТУУслуг.Субконто)
) КАК Реализация
ПО
    Реализация.Контрагент = Ключи.Контрагент
    И Реализация.ДоговорКонтрагента = Ключи.ДоговорКонтрагента
    И Реализация.НоменклатурнаяГруппа = Ключи.НоменклатурнаяГруппа

ЛЕВОЕ СОЕДИНЕНИЕ
(ВЫБРАТЬ
    НАЧАЛОПЕРИОДА(ФактическиеДанные.Период,ДЕНЬ) КАК Дата,
    ФактическиеДанные.Контрагент,
    ФактическиеДанные.ДоговорКонтрагента,
    ФактическиеДанные.НоменклатурнаяГруппа,
    СУММА(ФактическиеДанные.Количество) КАК ФактКоличество,
    СУММА(ФактическиеДанные.Сумма) КАК ФактСумма
 FROM Документ.бит_ПолучениеФактическихДанных.ФактическиеДанные КАК ФактическиеДанные
 WHERE
     ФактическиеДанные.Ссылка.Проведен
 GROUP BY
     НАЧАЛОПЕРИОДА(ФактическиеДанные.Период,ДЕНЬ),
     ФактическиеДанные.Контрагент,
     ФактическиеДанные.ДоговорКонтрагента,
     ФактическиеДанные.НоменклатурнаяГруппа
) КАК Факт
ПО
    Факт.Контрагент = Ключи.Контрагент
    И Факт.ДоговорКонтрагента = Ключи.ДоговорКонтрагента
    И Факт.НоменклатурнаяГруппа = Ключи.НоменклатурнаяГруппа

ЛЕВОЕ СОЕДИНЕНИЕ
(ВЫБРАТЬ
    НАЧАЛОПЕРИОДА(Корректировка.Дата,ДЕНЬ) КАК Дата,
    Корректировка.Контрагент,
    Корректировка.ДоговорКонтрагента,
    ЕСТЬNULL(КорректировкаТовары.НоменклатурнаяГруппа,КорректировкаУслуги.НоменклатурнаяГруппа) КАК НоменклатурнаяГруппа,
    СУММА(
        ВЫБОР
            КОГДА ЕСТЬNULL(КорректировкаУслуги.Количество,0)>0
                ТОГДА ЕСТЬNULL(КорректировкаУслуги.Количество,0)
            ИНАЧЕ ЕСТЬNULL(КорректировкаТовары.Количество,0)
        КОНЕЦ
    ) КАК КоррКоличество,
    СУММА(
        ВЫБОР
            КОГДА ЕСТЬNULL(КорректировкаУслуги.Сумма,0)>0
                ТОГДА ЕСТЬNULL(КорректировкаУслуги.Сумма,0)
            ИНАЧЕ ЕСТЬNULL(КорректировкаТовары.Сумма,0)
        КОНЕЦ
    ) КАК КоррСумма
 FROM Документ.КорректировкаРеализации КАК Корректировка
     ЛЕВОЕ СОЕДИНЕНИЕ 
        (ВЫБРАТЬ
             Товары.Ссылка,
             Товары.Субконто КАК НоменклатурнаяГруппа,
             СУММА(Товары.Количество) КАК Количество,
             СУММА(Товары.Сумма) КАК Сумма
         ИЗ Документ.КорректировкаРеализации.Товары КАК Товары
         СГРУППИРОВАТЬ ПО Товары.Ссылка,Товары.Субконто
        ) КАК КорректировкаТовары
         ПО Корректировка.Ссылка = КорректировкаТовары.Ссылка
     ЛЕВОЕ СОЕДИНЕНИЕ
        (ВЫБРАТЬ
             Услуги.Ссылка,
             СУММА(Услуги.Количество) КАК Количество,
             СУММА(Услуги.Сумма) КАК Сумма,
             Услуги.НоменклатурнаяГруппа
         ИЗ Документ.КорректировкаРеализации.Услуги КАК Услуги
         СГРУППИРОВАТЬ ПО Услуги.Ссылка, Услуги.НоменклатурнаяГруппа
        ) КАК КорректировкаУслуги
         ПО Корректировка.Ссылка = КорректировкаУслуги.Ссылка
 GROUP BY
    НАЧАЛОПЕРИОДА(Корректировка.Дата,ДЕНЬ),
    Корректировка.Контрагент,
    Корректировка.ДоговорКонтрагента,
    ЕСТЬNULL(КорректировкаТовары.НоменклатурнаяГруппа,КорректировкаУслуги.НоменклатурнаяГруппа)
) КАК Корректировка

УПОРЯДОЧИТЬ ПО
    Ключи.Дата,
    Ключи.Контрагент,
    Ключи.ДоговорКонтрагента;
