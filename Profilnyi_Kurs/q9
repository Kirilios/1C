ВЫБРАТЬ
	Ключи.Дата КАК Дата,
	Ключи.Контрагент КАК Контрагент,
	Ключи.ДоговорКонтрагента КАК ДоговорКонтрагента,
	Ключи.НоменклатурнаяГруппа КАК НоменклатурнаяГруппа,
	ЕСТЬNULL(Реализация.РеализацияКоличество, 0) РеализацияКоличество,
	ЕСТЬNULL(Реализация.РеализацияСумма, 0) КАК РеализацияСумма,
	ЕСТЬNULL(Факт.ФактКоличество, 0) КАК ФактКоличество,
	ЕСТЬNULL(Факт.ФактСумма, 0) КАК ФактСумма
ИЗ
	(ВЫБРАТЬ
		Реализация.Дата КАК Дата,
		Реализация.Контрагент КАК Контрагент,
		Реализация.ДоговорКонтрагента КАК ДоговорКонтрагента,
		Реализация.НоменклатурнаяГруппа КАК НоменклатурнаяГруппа
	ИЗ
		(ВЫБРАТЬ
			Реализация.Дата КАК Дата,
			Реализация.Контрагент КАК Контрагент,
			Реализация.ДоговорКонтрагента КАК ДоговорКонтрагента,
			ЕСТЬNULL(РТУТовары.Субконто, РТУУслуг.Субконто) КАК НоменклатурнаяГруппа
		ИЗ
			Документ.РеализацияТоваровУслуг КАК Реализация
				ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Товары КАК РТУТовары
				ПО Реализация.Ссылка = РТУТовары.Ссылка
				ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Услуги КАК РТУУслуг
				ПО Реализация.Ссылка = РТУУслуг.Ссылка
		ГДЕ
			Реализация.Проведен
			И Реализация.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			И Реализация.Склад.Наименование ПОДОБНО "%Склад отгрузки готовой продукции%"
			И СОКРЛ(СОКРП(Реализация.ПодразделениеОрганизации.Код)) = "53"
		
		СГРУППИРОВАТЬ ПО
			Реализация.Дата,
			Реализация.Контрагент,
			Реализация.ДоговорКонтрагента,
			ЕСТЬNULL(РТУТовары.Субконто, РТУУслуг.Субконто)) КАК Реализация
	
	ОБЪЕДИНИТЬ ВСЕ
	
	ВЫБРАТЬ
		ФактАгрегат.Дата,
		ФактАгрегат.Контрагент,
		ФактАгрегат.ДоговорКонтрагента,
		ФактАгрегат.НоменклатурнаяГруппа
	ИЗ
		(ВЫБРАТЬ
			ФактическиеДанные.Период КАК Дата,
			ФактическиеДанные.Контрагент КАК Контрагент,
			ФактическиеДанные.ДоговорКонтрагента КАК ДоговорКонтрагента,
			ФактическиеДанные.НоменклатурнаяГруппа КАК НоменклатурнаяГруппа,
			СУММА(ФактическиеДанные.Количество) КАК ФактКоличество,
			СУММА(ФактическиеДанные.Сумма) КАК ФактСумма
		ИЗ
			Документ.бит_ПолучениеФактическихДанных.ФактическиеДанные КАК ФактическиеДанные
		ГДЕ
			ФактическиеДанные.Ссылка.Проведен
			И ФактическиеДанные.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
			И ФактическиеДанные.Ссылка.Сценарий.Наименование = "ФАКТ"
			И ФактическиеДанные.СтатьяОборотов.ТипСтатьи = ЗНАЧЕНИЕ(Перечисление.бит_ТипыСтатейОборотов.БДР)
			И ФактическиеДанные.СтатьяОборотов.Кодификатор ПОДОБНО "11.42.0[0-4][0-3]%"
		
		СГРУППИРОВАТЬ ПО
			ФактическиеДанные.Период,
			ФактическиеДанные.Контрагент,
			ФактическиеДанные.ДоговорКонтрагента,
			ФактическиеДанные.НоменклатурнаяГруппа) КАК ФактАгрегат) КАК Ключи
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			Реализация.Дата КАК Дата,
			Реализация.Контрагент КАК Контрагент,
			Реализация.ДоговорКонтрагента КАК ДоговорКонтрагента,
			ЕСТЬNULL(РТУТовары.Субконто, РТУУслуг.Субконто) КАК НоменклатурнаяГруппа,
			СУММА(
				ВЫБОР 
					КОГДА (ЕСТЬNULL(РТУТовары.Сумма, 0) > 0)
					ТОГДА (ЕСТЬNULL(РТУТовары.Количество, 0))
				ИНАЧЕ 0
				КОНЕЦ
				+
				ЕСТЬNULL(РТУУслуг.Количество,0)
				) КАК РеализацияКоличество,
			СУММА(ЕСТЬNULL(РТУТовары.Сумма, 0) + ЕСТЬNULL(РТУУслуг.Сумма, 0)) КАК РеализацияСумма
		ИЗ
			Документ.РеализацияТоваровУслуг КАК Реализация
				ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Товары КАК РТУТовары
				ПО Реализация.Ссылка = РТУТовары.Ссылка
				ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Услуги КАК РТУУслуг
				ПО Реализация.Ссылка = РТУУслуг.Ссылка
		ГДЕ
			Реализация.Проведен
			И Реализация.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
			И Реализация.Склад.Наименование ПОДОБНО "%Склад отгрузки готовой продукции%"
			И СОКРЛ(СОКРП(Реализация.ПодразделениеОрганизации.Код)) = "53"
		
		СГРУППИРОВАТЬ ПО
			Реализация.Дата,
			Реализация.Контрагент,
			Реализация.ДоговорКонтрагента,
			ЕСТЬNULL(РТУТовары.Субконто, РТУУслуг.Субконто)) КАК Реализация
		ПО (Ключи.Дата = Реализация.Дата)
			И (Ключи.Контрагент = Реализация.Контрагент)
			И (Ключи.ДоговорКонтрагента = Реализация.ДоговорКонтрагента)
			И (Ключи.НоменклатурнаяГруппа = Реализация.НоменклатурнаяГруппа)
		ЛЕВОЕ СОЕДИНЕНИЕ (ВЫБРАТЬ
			ФактАгрегат.Дата КАК Дата,
			ФактАгрегат.Контрагент КАК Контрагент,
			ФактАгрегат.ДоговорКонтрагента КАК ДоговорКонтрагента,
			ФактАгрегат.НоменклатурнаяГруппа КАК НоменклатурнаяГруппа,
			ФактАгрегат.ФактКоличество КАК ФактКоличество,
			ФактАгрегат.ФактСумма КАК ФактСумма
		ИЗ
			(ВЫБРАТЬ
				ФактическиеДанные.Период КАК Дата,
				ФактическиеДанные.Контрагент КАК Контрагент,
				ФактическиеДанные.ДоговорКонтрагента КАК ДоговорКонтрагента,
				ФактическиеДанные.НоменклатурнаяГруппа КАК НоменклатурнаяГруппа,
				СУММА(ФактическиеДанные.Количество) КАК ФактКоличество,
				СУММА(ФактическиеДанные.Сумма) КАК ФактСумма
			ИЗ
				Документ.бит_ПолучениеФактическихДанных.ФактическиеДанные КАК ФактическиеДанные
			ГДЕ
				ФактическиеДанные.Ссылка.Проведен
				И ФактическиеДанные.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
				И ФактическиеДанные.Ссылка.Сценарий.Наименование = "ФАКТ"
				И ФактическиеДанные.СтатьяОборотов.ТипСтатьи = ЗНАЧЕНИЕ(Перечисление.бит_ТипыСтатейОборотов.БДР)
				И ФактическиеДанные.СтатьяОборотов.Кодификатор ПОДОБНО "11.42.0[0-4][0-3]%"
			
			СГРУППИРОВАТЬ ПО
				ФактическиеДанные.Период,
				ФактическиеДанные.Контрагент,
				ФактическиеДанные.ДоговорКонтрагента,
				ФактическиеДанные.НоменклатурнаяГруппа) КАК ФактАгрегат) КАК Факт
		ПО (Ключи.Дата = Факт.Дата)
			И (Ключи.Контрагент = Факт.Контрагент)
			И (Ключи.ДоговорКонтрагента = Факт.ДоговорКонтрагента)
			И (Ключи.НоменклатурнаяГруппа = Факт.НоменклатурнаяГруппа)
