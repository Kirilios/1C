ВЫБРАТЬ
	ФактическиеДанные.Ссылка.Сценарий КАК Сценарий,
	ВЫБОР
		КОГДА ФактическиеДанные.Ссылка.Сценарий = &ВерсияПлана
			ТОГДА ФактическиеДанные.Период
		КОГДА ФактическиеДанные.Ссылка.Сценарий.Наименование = "13 Период"
			ТОГДА ДОБАВИТЬКДАТЕ(НАЧАЛОПЕРИОДА(&ДатаОтчета, ГОД), ГОД, 1)
		КОГДА ФактическиеДанные.Ссылка.Сценарий.Наименование = "ФАКТ"
			ТОГДА ВЫБОР
					КОГДА ГОД(ФактическиеДанные.Период) < ГОД(&ДатаОтчета)
						ТОГДА ДОБАВИТЬКДАТЕ(НАЧАЛОПЕРИОДА(&ДатаОтчета, ГОД), ДЕНЬ, -1)
					ИНАЧЕ НАЧАЛОПЕРИОДА(ФактическиеДанные.Период, МЕСЯЦ)
				КОНЕЦ
	КОНЕЦ КАК Период,
	ФактическиеДанные.СтатьяОборотов КАК СтатьяОборотов,
	ФактическиеДанные.Контрагент КАК Контрагент,
	ФактическиеДанные.ДоговорКонтрагента КАК ДоговорКонтрагента,
	ФактическиеДанные.НоменклатурнаяГруппа КАК НоменклатурнаяГруппа,
	СУММА(ФактическиеДанные.Количество) КАК Количество,
	СУММА(ФактическиеДанные.Сумма) КАК Сумма,
	СУММА(ВЫБОР
			КОГДА ФактическиеДанные.ДоговорКонтрагента.Валютный
				ТОГДА ВЫБОР
						КОГДА ЕСТЬNULL(КурсыВалют.Курс, 0) <> 0
							ТОГДА ВЫРАЗИТЬ(ФактическиеДанные.Сумма / ЕСТЬNULL(КурсыВалют.Курс, 0) КАК ЧИСЛО(16, 2))
						ИНАЧЕ 0
					КОНЕЦ
			ИНАЧЕ ФактическиеДанные.Сумма
		КОНЕЦ) КАК СуммаВВалюте,
	СУММА(ВЫБОР
			КОГДА ФактическиеДанные.ДоговорКонтрагента.Валютный
				ТОГДА ВЫБОР
						КОГДА ЕСТЬNULL(КурсыВалютПлан.Курс, 0) <> 0
							ТОГДА ВЫРАЗИТЬ(ФактическиеДанные.Сумма / ЕСТЬNULL(КурсыВалютПлан.Курс, 0) КАК ЧИСЛО(16, 2))
						ИНАЧЕ 0
					КОНЕЦ
			ИНАЧЕ ФактическиеДанные.Сумма
		КОНЕЦ) КАК СуммаВВалютеПлановыйКурс,
	СУММА(ВЫБОР
			КОГДА ФактическиеДанные.ДоговорКонтрагента.Валютный
				ТОГДА ВЫБОР
						КОГДА ЕСТЬNULL(КурсыВалютПланСледующийГод.Курс, 0) <> 0
							ТОГДА ВЫРАЗИТЬ(ФактическиеДанные.Сумма / ЕСТЬNULL(КурсыВалютПланСледующийГод.Курс, 0) КАК ЧИСЛО(16, 2))
						ИНАЧЕ 0
					КОНЕЦ
			ИНАЧЕ ФактическиеДанные.Сумма
		КОНЕЦ) КАК СуммаВВалютеПлановыйКурсСледующийГод,
	ФактическиеДанные.Период КАК Период1
ПОМЕСТИТЬ ВТ
ИЗ
	Документ.бит_ПолучениеФактическихДанных.ФактическиеДанные КАК ФактическиеДанные
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.КурсыВалют КАК КурсыВалют
		ПО ФактическиеДанные.ДоговорКонтрагента.ВалютаВзаиморасчетов = КурсыВалют.Валюта
			И ФактическиеДанные.Период = КурсыВалют.Период
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.бит_КурсыВалютОтчетности КАК КурсыВалютПлан
		ПО ФактическиеДанные.ДоговорКонтрагента.ВалютаВзаиморасчетов = КурсыВалютПлан.Валюта
			И (НАЧАЛОПЕРИОДА(ФактическиеДанные.Период, ГОД) = КурсыВалютПлан.Период)
		ЛЕВОЕ СОЕДИНЕНИЕ РегистрСведений.бит_КурсыВалютОтчетности КАК КурсыВалютПланСледующийГод
		ПО ФактическиеДанные.ДоговорКонтрагента.ВалютаВзаиморасчетов = КурсыВалютПланСледующийГод.Валюта
			И (ДОБАВИТЬКДАТЕ(НАЧАЛОПЕРИОДА(ФактическиеДанные.Период, ГОД), ГОД, 1) = КурсыВалютПланСледующийГод.Период)
ГДЕ
	ФактическиеДанные.Ссылка.Проведен
	И (ФактическиеДанные.Ссылка.Сценарий.Наименование В ("13 Период", "ФАКТ")
			ИЛИ ФактическиеДанные.Ссылка.Сценарий = &ВерсияПлана)
	И ВЫБОР
			КОГДА ФактическиеДанные.Ссылка.Сценарий.Наименование = "13 Период"
					ИЛИ ФактическиеДанные.Ссылка.Сценарий = &ВерсияПлана
				ТОГДА ГОД(ФактическиеДанные.Период) = ГОД(&ДатаОтчета)
			ИНАЧЕ ГОД(ФактическиеДанные.Период) <= ГОД(&ДатаОтчета)
		КОНЕЦ
	И ФактическиеДанные.СтатьяОборотов.ТипСтатьи = ЗНАЧЕНИЕ(Перечисление.бит_ТипыСтатейОборотов.БДР)
	И ФактическиеДанные.СтатьяОборотов.Кодификатор ПОДОБНО "11.42.0[0-4][0-3]%"

СГРУППИРОВАТЬ ПО
	ФактическиеДанные.Ссылка.Сценарий,
	ВЫБОР
		КОГДА ФактическиеДанные.Ссылка.Сценарий = &ВерсияПлана
			ТОГДА ФактическиеДанные.Период
		КОГДА ФактическиеДанные.Ссылка.Сценарий.Наименование = "13 Период"
			ТОГДА ДОБАВИТЬКДАТЕ(НАЧАЛОПЕРИОДА(&ДатаОтчета, ГОД), ГОД, 1)
		КОГДА ФактическиеДанные.Ссылка.Сценарий.Наименование = "ФАКТ"
			ТОГДА ВЫБОР
					КОГДА ГОД(ФактическиеДанные.Период) < ГОД(&ДатаОтчета)
						ТОГДА ДОБАВИТЬКДАТЕ(НАЧАЛОПЕРИОДА(&ДатаОтчета, ГОД), ДЕНЬ, -1)
					ИНАЧЕ НАЧАЛОПЕРИОДА(ФактическиеДанные.Период, МЕСЯЦ)
				КОНЕЦ
	КОНЕЦ,
	ФактическиеДанные.СтатьяОборотов,
	ФактическиеДанные.Контрагент,
	ФактическиеДанные.ДоговорКонтрагента,
	ФактическиеДанные.НоменклатурнаяГруппа,
	ФактическиеДанные.Период