ВЫБРАТЬ
    ДанныеОбъединенные.ДоговорКонтрагента,
    ДанныеОбъединенные.Контрагент,
    СУММА(ДанныеОбъединенные.Количество) КАК Количество,
    СУММА(ДанныеОбъединенные.Сумма) КАК Сумма
ИЗ
(
    ////////////////////////////////////////////
    // 1. Реализация товаров
    ////////////////////////////////////////////
    ВЫБРАТЬ
        Реализация.ДоговорКонтрагента,
        Реализация.Контрагент,
        СУММА(ЕСТЬNULL(ТоварыАгр.Количество,0)) КАК Количество,
        СУММА(ЕСТЬNULL(ТоварыАгр.Сумма,0)) КАК Сумма,
        0 КАК СчетУчета,
        0 КАК ВидОперации
    ИЗ
        Документ.РеализацияТоваровУслуг КАК Реализация
            ЛЕВОЕ СОЕДИНЕНИЕ
            (
                ВЫБРАТЬ
                    Товары.Ссылка КАК Документ,
                    СУММА(Товары.Количество) КАК Количество,
                    СУММА(Товары.Сумма) КАК Сумма
                ИЗ
                    Документ.РеализацияТоваровУслуг.Товары КАК Товары
                СГРУППИРОВАТЬ ПО Товары.Ссылка
            ) КАК ТоварыАгр
            ПО Реализация.Ссылка = ТоварыАгр.Документ
    ГДЕ
        Реализация.Проведен
        И Реализация.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
        И Реализация.Склад.Наименование ПОДОБНО "%Склад отгрузки готовой продукции%"
        И СОКРЛ(СОКРП(Реализация.ПодразделениеОрганизации.Код)) = "53"
    СГРУППИРОВАТЬ ПО
        Реализация.ДоговорКонтрагента,
        Реализация.Контрагент

    ОБЪЕДИНИТЬ ВСЕ

    ////////////////////////////////////////////
    // 2. Реализация услуг
    ////////////////////////////////////////////
    ВЫБРАТЬ
        Реализация.ДоговорКонтрагента,
        Реализация.Контрагент,
        СУММА(ЕСТЬNULL(УслугиАгр.Количество,0)) КАК Количество,
        СУММА(ЕСТЬNULL(УслугиАгр.Сумма,0)) КАК Сумма,
        0 КАК СчетУчета,
        0 КАК ВидОперации
    ИЗ
        Документ.РеализацияТоваровУслуг КАК Реализация
            ЛЕВОЕ СОЕДИНЕНИЕ
            (
                ВЫБРАТЬ
                    Услуги.Ссылка КАК Документ,
                    СУММА(Услуги.Количество) КАК Количество,
                    СУММА(Услуги.Сумма) КАК Сумма
                ИЗ
                    Документ.РеализацияТоваровУслуг.Услуги КАК Услуги
                СГРУППИРОВАТЬ ПО Услуги.Ссылка
            ) КАК УслугиАгр
            ПО Реализация.Ссылка = УслугиАгр.Документ
    ГДЕ
        Реализация.Проведен
        И Реализация.ВидОперации = "Товары и услуги"
        И Реализация.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
        И Реализация.Склад.Наименование ПОДОБНО "%Склад отгрузки готовой продукции%"
        И СОКРЛ(СОКРП(Реализация.ПодразделениеОрганизации.Код)) = "53"
    СГРУППИРОВАТЬ ПО
        Реализация.ДоговорКонтрагента,
        Реализация.Контрагент

    ОБЪЕДИНИТЬ ВСЕ

    ////////////////////////////////////////////
    // 3. Фактические данные
    ////////////////////////////////////////////
    ВЫБРАТЬ
        ФактическиеДанные.ДоговорКонтрагента,
        ФактическиеДанные.Контрагент,
        СУММА(ФактическиеДанные.Количество) КАК Количество,
        СУММА(ФактическиеДанные.Сумма) КАК Сумма,
        0 КАК СчетУчета,
        0 КАК ВидОперации
    ИЗ
        Документ.бит_ПолучениеФактическихДанных.ФактическиеДанные КАК ФактическиеДанные
    ГДЕ
        ФактическиеДанные.Ссылка.Проведен
        И ФактическиеДанные.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
        И ФактическиеДанные.Ссылка.Сценарий.Наименование = "ФАКТ"
        И ФактическиеДанные.СтатьяОборотов.ТипСтатьи = ЗНАЧЕНИЕ(Перечисление.бит_ТипыСтатейОборотов.БДР)
        И ФактическиеДанные.СтатьяОборотов.Кодификатор ПОДОБНО "11.42.0[0-4][0-3]%"
    СГРУППИРОВАТЬ ПО
        ФактическиеДанные.ДоговорКонтрагента,
        ФактическиеДанные.Контрагент
) КАК ДанныеОбъединенные

СГРУППИРОВАТЬ ПО
    ДанныеОбъединенные.ДоговорКонтрагента,
    ДанныеОбъединенные.Контрагент
