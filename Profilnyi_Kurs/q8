ВЫБРАТЬ
    НАЧАЛОПЕРИОДА(Р.Дата, ДЕНЬ) КАК Дата,
    Р.Контрагент КАК Контрагент,
    Р.ДоговорКонтрагента КАК ДоговорКонтрагента,
    ЕСТЬNULL(Р.НоменклатурнаяГруппа, К.НоменклатурнаяГруппа) КАК НоменклатурнаяГруппа,
    ЕСТЬNULL(Р.РеализацияКоличество, 0) КАК РеализацияКоличество,
    ЕСТЬNULL(Р.РеализацияСумма, 0) КАК РеализацияСумма,
    ЕСТЬNULL(F.ФактКоличество, 0) КАК ФактКоличество,
    ЕСТЬNULL(F.ФактСумма, 0) КАК ФактСумма,
    ЕСТЬNULL(K.КорректировкаКоличество, 0) КАК КорректировкаКоличество,
    ЕСТЬNULL(K.КорректировкаСумма, 0) КАК КорректировкаСумма

ИЗ
    (ВЫБРАТЬ
        Реализация.Ссылка,
        Реализация.Дата,
        Реализация.Контрагент,
        Реализация.ДоговорКонтрагента,
        ЕСТЬNULL(Товары.Субконто, Услуги.Субконто) КАК НоменклатурнаяГруппа,
        СУММА(ЕСТЬNULL(Товары.Количество,0)) КАК РеализацияКоличество,
        СУММА(ЕСТЬNULL(Товары.Сумма,0) + ЕСТЬNULL(Услуги.Сумма,0)) КАК РеализацияСумма
    ИЗ
        Документ.РеализацияТоваровУслуг КАК Реализация
        ЛЕВОЕ СОЕДИНЕНИЕ Реализация.Товары КАК Товары
            ПО Реализация.Ссылка = Товары.Ссылка
        ЛЕВОЕ СОЕДИНЕНИЕ Реализация.Услуги КАК Услуги
            ПО Реализация.Ссылка = Услуги.Ссылка
    ГДЕ
        Реализация.Проведен
        И Реализация.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
    СГРУППИРОВАТЬ ПО
        Реализация.Ссылка,
        Реализация.Дата,
        Реализация.Контрагент,
        Реализация.ДоговорКонтрагента,
        ЕСТЬNULL(Товары.Субконто, Услуги.Субконто)
    ) КАК Р

    ЛЕВОЕ СОЕДИНЕНИЕ
    (ВЫБРАТЬ
        НАЧАЛОПЕРИОДА(F.Период, ДЕНЬ) КАК Дата,
        F.Контрагент,
        F.ДоговорКонтрагента,
        F.НоменклатурнаяГруппа,
        СУММА(F.Количество) КАК ФактКоличество,
        СУММА(F.Сумма) КАК ФактСумма
    ИЗ
        Документ.бит_ПолучениеФактическихДанных.ФактическиеДанные КАК F
    ГДЕ
        F.Ссылка.Проведен
        И F.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
    СГРУППИРОВАТЬ ПО
        НАЧАЛОПЕРИОДА(F.Период, ДЕНЬ),
        F.Контрагент,
        F.ДоговорКонтрагента,
        F.НоменклатурнаяГруппа
    ) КАК F
    ПО
        НАЧАЛОПЕРИОДА(Р.Дата, ДЕНЬ) = F.Дата
        И Р.Контрагент = F.Контрагент
        И Р.ДоговорКонтрагента = F.ДоговорКонтрагента
        И Р.НоменклатурнаяГруппа = F.НоменклатурнаяГруппа

    ЛЕВОЕ СОЕДИНЕНИЕ
    (ВЫБРАТЬ
        K.ДокументРеализации КАК СсылкаРеализации,
        Т.НоменклатурнаяГруппа,
        СУММА(ЕСТЬNULL(Т.Количество,0) + ЕСТЬNULL(U.Количество,0)) КАК КорректировкаКоличество,
        СУММА(ЕСТЬNULL(Т.Сумма,0) + ЕСТЬNULL(U.Сумма,0)) КАК КорректировкаСумма
    ИЗ
        Документ.КорректировкаРеализации КАК K
        ЛЕВОЕ СОЕДИНЕНИЕ K.Товары КАК Т
            ПО K.Ссылка = Т.Ссылка
        ЛЕВОЕ СОЕДИНЕНИЕ K.Услуги КАК U
            ПО K.Ссылка = U.Ссылка
    СГРУППИРОВАТЬ ПО
        K.ДокументРеализации,
        Т.НоменклатурнаяГруппа
    ) КАК K
    ПО Р.Ссылка = K.СсылкаРеализации

УПОРЯДОЧИТЬ ПО
    Дата,
    Контрагент,
    ДоговорКонтрагента,
    НоменклатурнаяГруппа
