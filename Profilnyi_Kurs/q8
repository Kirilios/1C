ВЫБРАТЬ
    НАЧАЛОПЕРИОДА(Р.Дата, ДЕНЬ) КАК Дата,
    Р.Контрагент,
    Р.ДоговорКонтрагента,
    Р.НоменклатурнаяГруппа,
    ЕСТЬNULL(Р.РеализацияКоличество, 0) КАК РеализацияКоличество,
    ЕСТЬNULL(Р.РеализацияСумма, 0) КАК РеализацияСумма,
    ЕСТЬNULL(F.ФактКоличество, 0) КАК ФактКоличество,
    ЕСТЬNULL(F.ФактСумма, 0) КАК ФактСумма,
    ЕСТЬNULL(K.КорректировкаКоличество, 0) КАК КорректировкаКоличество,
    ЕСТЬNULL(K.КорректировкаСумма, 0) КАК КорректировкаСумма
ИЗ
    (
        // Подзапрос Реализации
        ВЫБРАТЬ
            Реализация.Ссылка КАК ДокументСсылка,
            Реализация.Дата,
            Реализация.Контрагент,
            Реализация.ДоговорКонтрагента,
            ЕСТЬNULL(РТУТовары.Субконто, РТУУслуг.Субконто) КАК НоменклатурнаяГруппа,
            СУММА(
                ВЫБОР
                    КОГДА ЕСТЬNULL(РТУТовары.Сумма,0) > 0 ТОГДА ЕСТЬNULL(РТУТовары.Количество,0)
                    ИНАЧЕ 0
                КОНЕЦ
                + ЕСТЬNULL(РТУУслуг.Количество,0)
            ) КАК РеализацияКоличество,
            СУММА(
                ЕСТЬNULL(РТУТовары.Сумма,0) + ЕСТЬNULL(РТУУслуг.Сумма,0)
            ) КАК РеализацияСумма
        ИЗ
            Документ.РеализацияТоваровУслуг КАК Реализация
            ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Товары КАК РТУТовары
                ПО Реализация.Ссылка = РТУТовары.Ссылка
            ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Услуги КАК РТУУслуг
                ПО Реализация.Ссылка = РТУУслуг.Ссылка
        ГДЕ
            Реализация.Проведен
            И Реализация.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
        СГРУППИРОВАТЬ ПО
            Реализация.Ссылка,
            Реализация.Дата,
            Реализация.Контрагент,
            Реализация.ДоговорКонтрагента,
            ЕСТЬNULL(РТУТовары.Субконто, РТУУслуг.Субконто)
    ) КАК Р

    ЛЕВОЕ СОЕДИНЕНИЕ
    (
        // Подзапрос Факта
        ВЫБРАТЬ
            НАЧАЛОПЕРИОДА(ФД.Период, ДЕНЬ) КАК Дата,
            ФД.Контрагент,
            ФД.ДоговорКонтрагента,
            ФД.НоменклатурнаяГруппа,
            СУММА(ФД.Количество) КАК ФактКоличество,
            СУММА(ФД.Сумма) КАК ФактСумма
        ИЗ
            Документ.бит_ПолучениеФактическихДанных.ФактическиеДанные КАК ФД
        ГДЕ
            ФД.Ссылка.Проведен
            И ФД.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
        СГРУППИРОВАТЬ ПО
            НАЧАЛОПЕРИОДА(ФД.Период, ДЕНЬ),
            ФД.Контрагент,
            ФД.ДоговорКонтрагента,
            ФД.НоменклатурнаяГруппа
    ) КАК F
    ПО
        НАЧАЛОПЕРИОДА(Р.Дата, ДЕНЬ) = F.Дата
        И Р.Контрагент = F.Контрагент
        И Р.ДоговорКонтрагента = F.ДоговорКонтрагента
        И Р.НоменклатурнаяГруппа = F.НоменклатурнаяГруппа

    ЛЕВОЕ СОЕДИНЕНИЕ
    (
        // Подзапрос Корректировок
        ВЫБРАТЬ
            Корр.ДокументРеализации КАК ДокументСсылка,
            КоррТовары.НоменклатурнаяГруппа,
            СУММА(ЕСТЬNULL(КоррТовары.Количество,0)) КАК КорректировкаКоличество,
            СУММА(ЕСТЬNULL(КоррТовары.Сумма,0)) КАК КорректировкаСумма
        ИЗ
            Документ.КорректировкаРеализации КАК Корр
            ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаРеализации.Товары КАК КоррТовары
                ПО Корр.Ссылка = КоррТовары.Ссылка
        ГДЕ
            Корр.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
        СГРУППИРОВАТЬ ПО
            Корр.ДокументРеализации,
            КоррТовары.НоменклатурнаяГруппа
    ) КАК K
    ПО
        Р.ДокументСсылка = K.ДокументСсылка
        И Р.НоменклатурнаяГруппа = K.НоменклатурнаяГруппа

УПОРЯДОЧИТЬ ПО
    Дата,
    Контрагент,
    ДоговорКонтрагента,
    НоменклатурнаяГруппа
