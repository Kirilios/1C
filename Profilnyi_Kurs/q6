ВЫБРАТЬ
    НАЧАЛОПЕРИОДА(Реализация.Дата, ДЕНЬ) КАК Дата,
    Реализация.Контрагент КАК Контрагент,
    Реализация.ДоговорКонтрагента КАК ДоговорКонтрагента,
    ЕСТЬNULL(РТУТовары.Субконто, РТУУслуг.Субконто) КАК НоменклатурнаяГруппа,
    СУММА(ЕСТЬNULL(РТУТовары.Количество,0) + ЕСТЬNULL(РТУУслуг.Количество,0)) КАК РеализацияКоличество,
    СУММА(ЕСТЬNULL(РТУТовары.Сумма,0) + ЕСТЬNULL(РТУУслуг.Сумма,0)) КАК РеализацияСумма,
    СУММА(ЕСТЬNULL(Факт.ФактКоличество,0)) КАК ФактКоличество,
    СУММА(ЕСТЬNULL(Факт.ФактСумма,0)) КАК ФактСумма,
    СУММА(ЕСТЬNULL(КорректировкаТовары.Количество,0) + ЕСТЬNULL(КорректировкаУслуги.Количество,0)) КАК КорректировкаКоличество,
    СУММА(ЕСТЬNULL(КорректировкаТовары.Сумма,0) + ЕСТЬNULL(КорректировкаУслуги.Сумма,0)) КАК КорректировкаСумма
ИЗ
    Документ.РеализацияТоваровУслуг КАК Реализация
    ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Товары КАК РТУТовары
        ПО Реализация.Ссылка = РТУТовары.Ссылка
    ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Услуги КАК РТУУслуг
        ПО Реализация.Ссылка = РТУУслуг.Ссылка
    ЛЕВОЕ СОЕДИНЕНИЕ (
        ВЫБРАТЬ
            ФактическиеДанные.Контрагент,
            ФактическиеДанные.ДоговорКонтрагента,
            ФактическиеДанные.НоменклатурнаяГруппа,
            НАЧАЛОПЕРИОДА(ФактическиеДанные.Период, ДЕНЬ) КАК Дата,
            СУММА(ФактическиеДанные.Количество) КАК ФактКоличество,
            СУММА(ФактическиеДанные.Сумма) КАК ФактСумма
        ИЗ
            Документ.бит_ПолучениеФактическихДанных.ФактическиеДанные КАК ФактическиеДанные
        ГДЕ
            ФактическиеДанные.Ссылка.Проведен
            И ФактическиеДанные.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
            И ФактическиеДанные.Ссылка.Сценарий.Наименование = "ФАКТ"
        СГРУППИРОВАТЬ ПО
            ФактическиеДанные.Контрагент,
            ФактическиеДанные.ДоговорКонтрагента,
            ФактическиеДанные.НоменклатурнаяГруппа,
            НАЧАЛОПЕРИОДА(ФактическиеДанные.Период, ДЕНЬ)
    ) КАК Факт
        ПО Реализация.Контрагент = Факт.Контрагент
        И Реализация.ДоговорКонтрагента = Факт.ДоговорКонтрагента
        И ЕСТЬNULL(РТУТовары.Субконто, РТУУслуг.Субконто) = Факт.НоменклатурнаяГруппа
        И НАЧАЛОПЕРИОДА(Реализация.Дата, ДЕНЬ) = Факт.Дата
    ЛЕВОЕ СОЕДИНЕНИЕ (
        ВЫБРАТЬ
            Корректировка.ДокументРеализации КАК ДокументРеализации,
            ЕСТЬNULL(Товары.Субконто,'') КАК НоменклатурнаяГруппа,
            СУММА(ЕСТЬNULL(Товары.Количество,0)) КАК Количество,
            СУММА(ЕСТЬNULL(Товары.Сумма,0)) КАК Сумма
        ИЗ
            Документ.КорректировкаРеализации.Товары КАК Товары
            ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КорректировкаРеализации КАК Корректировка
                ПО Корректировка.Ссылка = Товары.Ссылка
        ГДЕ
            Корректировка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
        СГРУППИРОВАТЬ ПО
            Корректировка.ДокументРеализации,
            ЕСТЬNULL(Товары.Субконто,'')
    ) КАК КорректировкаТовары
        ПО Реализация.Ссылка = КорректировкаТовары.ДокументРеализации
        И ЕСТЬNULL(РТУТовары.Субконто, РТУУслуг.Субконто) = КорректировкаТовары.НоменклатурнаяГруппа
    ЛЕВОЕ СОЕДИНЕНИЕ (
        ВЫБРАТЬ
            Корректировка.ДокументРеализации КАК ДокументРеализации,
            СУММА(ЕСТЬNULL(Услуги.Количество,0)) КАК Количество,
            СУММА(ЕСТЬNULL(Услуги.Сумма,0)) КАК Сумма
        ИЗ
            Документ.КорректировкаРеализации.Услуги КАК Услуги
            ВНУТРЕННЕЕ СОЕДИНЕНИЕ Документ.КорректировкаРеализации КАК Корректировка
                ПО Корректировка.Ссылка = Услуги.Ссылка
        ГДЕ
            Корректировка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
        СГРУППИРОВАТЬ ПО
            Корректировка.ДокументРеализации
    ) КАК КорректировкаУслуги
        ПО Реализация.Ссылка = КорректировкаУслуги.ДокументРеализации
ГДЕ
    Реализация.Проведен
    И Реализация.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
СГРУППИРОВАТЬ ПО
    Реализация.Дата,
    Реализация.Контрагент,
    Реализация.ДоговорКонтрагента,
    ЕСТЬNULL(РТУТовары.Субконто, РТУУслуг.Субконто)
УПОРЯДОЧИТЬ ПО
    Дата,
    Контрагент,
    ДоговорКонтрагента
