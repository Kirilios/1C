// ==== Реализация ====
ВЫБРАТЬ
    НАЧАЛОПЕРИОДА(Реализация.Дата, ДЕНЬ) КАК Дата,
    Реализация.Контрагент КАК Контрагент,
    Реализация.ДоговорКонтрагента КАК ДоговорКонтрагента,
    ЕСТЬNULL(РТУТовары.Субконто, РТУУслуг.Субконто) КАК НоменклатурнаяГруппа,
    СУММА(
        ВЫБОР КОГДА ЕСТЬNULL(РТУТовары.Сумма,0) > 0
            ТОГДА ЕСТЬNULL(РТУТовары.Количество,0)
        ИНАЧЕ 0 КОНЕЦ +
        ЕСТЬNULL(РТУУслуг.Количество,0)
    ) КАК РеализацияКоличество,
    СУММА(
        ЕСТЬNULL(РТУТовары.Сумма,0) + ЕСТЬNULL(РТУУслуг.Сумма,0)
    ) КАК РеализацияСумма,
    0 КАК ФактКоличество,
    0 КАК ФактСумма,
    0 КАК КорректировкаКоличество,
    0 КАК КорректировкаСумма
ИЗ
    Документ.РеализацияТоваровУслуг КАК Реализация
    ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Товары КАК РТУТовары
        ПО Реализация.Ссылка = РТУТовары.Ссылка
    ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Услуги КАК РТУУслуг
        ПО Реализация.Ссылка = РТУУслуг.Ссылка
ГДЕ
    Реализация.Проведен
    И Реализация.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
    И Реализация.Склад.Наименование ПОДОБНО "%Склад отгрузки готовой продукции%"
    И СОКРЛ(СОКРП(Реализация.ПодразделениеОрганизации.Код)) = "53"
СГРУППИРОВАТЬ ПО
    Реализация.Дата,
    Реализация.Контрагент,
    Реализация.ДоговорКонтрагента,
    ЕСТЬNULL(РТУТовары.Субконто, РТУУслуг.Субконто)

// ==== Факт ====
UNION ALL

ВЫБРАТЬ
    НАЧАЛОПЕРИОДА(ФактическиеДанные.Период, ДЕНЬ) КАК Дата,
    ФактическиеДанные.Контрагент,
    ФактическиеДанные.ДоговорКонтрагента,
    ФактическиеДанные.НоменклатурнаяГруппа,
    0 КАК РеализацияКоличество,
    0 КАК РеализацияСумма,
    СУММА(ФактическиеДанные.Количество) КАК ФактКоличество,
    СУММА(ФактическиеДанные.Сумма) КАК ФактСумма,
    0 КАК КорректировкаКоличество,
    0 КАК КорректировкаСумма
ИЗ
    Документ.бит_ПолучениеФактическихДанных.ФактическиеДанные КАК ФактическиеДанные
ГДЕ
    ФактическиеДанные.Ссылка.Проведен
    И ФактическиеДанные.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
    И ФактическиеДанные.Ссылка.Сценарий.Наименование = "ФАКТ"
    И ФактическиеДанные.СтатьяОборотов.ТипСтатьи = ЗНАЧЕНИЕ(Перечисление.бит_ТипыСтатейОборотов.БДР)
    И (
        ФактическиеДанные.СтатьяОборотов.Кодификатор ПОДОБНО "11.42.00[1-9]%" 
        ИЛИ ФактическиеДанные.СтатьяОборотов.Кодификатор ПОДОБНО "11.42.0[1-3][0-9]%" 
        ИЛИ ФактическиеДанные.СтатьяОборотов.Кодификатор ПОДОБНО "11.42.04[0-3]%"
    )
СГРУППИРОВАТЬ ПО
    НАЧАЛОПЕРИОДА(ФактическиеДанные.Период, ДЕНЬ),
    ФактическиеДанные.Контрагент,
    ФактическиеДанные.ДоговорКонтрагента,
    ФактическиеДанные.НоменклатурнаяГруппа

// ==== Корректировка ====
UNION ALL

ВЫБРАТЬ
    НАЧАЛОПЕРИОДА(Корректировка.Дата, ДЕНЬ) КАК Дата,
    Реализация.Контрагент,
    Реализация.ДоговорКонтрагента,
    ЕСТЬNULL(КоррТовары.Субконто,0) КАК НоменклатурнаяГруппа,
    0 КАК РеализацияКоличество,
    0 КАК РеализацияСумма,
    0 КАК ФактКоличество,
    0 КАК ФактСумма,
    СУММА(
        ВЫБОР
            КОГДА КоррУслуги.Количество > 0 ТОГДА КоррУслуги.Количество
            ИНАЧЕ КоррТовары.Количество
        КОНЕЦ
    ) КАК КорректировкаКоличество,
    СУММА(
        ВЫБОР
            КОГДА КоррУслуги.Сумма > 0 ТОГДА КоррУслуги.Сумма
            ИНАЧЕ КоррТовары.Сумма
        КОНЕЦ
    ) КАК КорректировкаСумма
ИЗ
    Документ.КорректировкаРеализации КАК Корректировка
    ЛЕВОЕ СОЕДИНЕНИЕ (
        ВЫБРАТЬ
            Товары.Ссылка,
            Товары.Субконто,
            СУММА(Товары.Количество) КАК Количество,
            СУММА(Товары.Сумма) КАК Сумма
        ИЗ Документ.КорректировкаРеализации.Товары КАК Товары
        СГРУППИРОВАТЬ ПО Товары.Ссылка, Товары.Субконто
    ) КАК КоррТовары
        ПО Корректировка.Ссылка = КоррТовары.Ссылка
    ЛЕВОЕ СОЕДИНЕНИЕ (
        ВЫБРАТЬ
            Услуги.Ссылка,
            СУММА(Услуги.Количество) КАК Количество,
            СУММА(Услуги.Сумма) КАК Сумма
        ИЗ Документ.КорректировкаРеализации.Услуги КАК Услуги
        СГРУППИРОВАТЬ ПО Услуги.Ссылка
    ) КАК КоррУслуги
        ПО Корректировка.Ссылка = КоррУслуги.Ссылка
    ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК Реализация
        ПО Корректировка.ДокументРеализации = Реализация.Ссылка
ГДЕ
    Корректировка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
СГРУППИРОВАТЬ ПО
    НАЧАЛОПЕРИОДА(Корректировка.Дата, ДЕНЬ),
    Реализация.Контрагент,
    Реализация.ДоговорКонтрагента,
    ЕСТЬNULL(КоррТовары.Субконто,0)

УПОРЯДОЧИТЬ ПО
    Дата,
    Контрагент,
    ДоговорКонтрагента
