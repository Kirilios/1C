ВЫБРАТЬ
    НАЧАЛОПЕРИОДА(Реализация.Дата, ДЕНЬ) КАК Дата,
    Реализация.Контрагент,
    Реализация.ДоговорКонтрагента,
    Реализация.НоменклатурнаяГруппа,
    Реализация.РеализацияКоличество,
    Реализация.РеализацияСумма,
    ЕСТЬNULL(Факт.ФактКоличество, 0) КАК ФактКоличество,
    ЕСТЬNULL(Факт.ФактСумма, 0) КАК ФактСумма,
    0 КАК КорректировкаКоличество,
    0 КАК КорректировкаСумма
ИЗ
    (ВЫБРАТЬ
        Реализация.Дата,
        Реализация.Контрагент,
        Реализация.ДоговорКонтрагента,

        // КОРРЕКТНОЕ ОПРЕДЕЛЕНИЕ НОМЕНКЛАТУРНОЙ ГРУППЫ
        ЕСТЬNULL(РТУТовары.Субконто, РТУУслуг.Субконто) КАК НоменклатурнаяГруппа,

        СУММА(
            ВЫБОР КОГДА ЕСТЬNULL(РТУТовары.Сумма,0) > 0
                ТОГДА ЕСТЬNULL(РТУТовары.Количество,0)
            ИНАЧЕ 0 КОНЕЦ
            +
            ЕСТЬNULL(РТУУслуг.Количество,0)
        ) КАК РеализацияКоличество,

        СУММА(ЕСТЬNULL(РТУТовары.Сумма,0) + ЕСТЬNULL(РТУУслуг.Сумма,0)) КАК РеализацияСумма

    ИЗ
        Документ.РеализацияТоваровУслуг КАК Реализация
        ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Товары КАК РТУТовары
            ПО Реализация.Ссылка = РТУТовары.Ссылка
        ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Услуги КАК РТУУслуг
            ПО Реализация.Ссылка = РТУУслуг.Ссылка

    ГДЕ
        Реализация.Проведен
        И Реализация.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания

    СГРУППИРОВАТЬ ПО
        Реализация.Дата,
        Реализация.Контрагент,
        Реализация.ДоговорКонтрагента,
        ЕСТЬNULL(РТУТовары.Субконто, РТУУслуг.Субконто)
    ) КАК Реализация

    ЛЕВОЕ СОЕДИНЕНИЕ (

        ВЫБРАТЬ
            НАЧАЛОПЕРИОДА(ФД.Период, ДЕНЬ) КАК Дата,
            ФД.Контрагент,
            ФД.ДоговорКонтрагента,
            ФД.НоменклатурнаяГруппа,
            СУММА(ФД.Количество) КАК ФактКоличество,
            СУММА(ФД.Сумма) КАК ФактСумма

        ИЗ
            Документ.бит_ПолучениеФактическихДанных.ФактическиеДанные КАК ФД
        ГДЕ
            ФД.Ссылка.Проведен
            И ФД.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
            И ФД.Ссылка.Сценарий.Наименование = "ФАКТ"

        СГРУППИРОВАТЬ ПО
            НАЧАЛОПЕРИОДА(ФД.Период, ДЕНЬ),
            ФД.Контрагент,
            ФД.ДоговорКонтрагента,
            ФД.НоменклатурнаяГруппа
    ) КАК Факт
    ПО Реализация.Дата = Факт.Дата
       И Реализация.Контрагент = Факт.Контрагент
       И Реализация.ДоговорКонтрагента = Факт.ДоговорКонтрагента
       И Реализация.НоменклатурнаяГруппа = Факт.НоменклатурнаяГруппа


ОБЪЕДИНИТЬ ВСЕ


ВЫБРАТЬ
    НАЧАЛОПЕРИОДА(К.Дата, ДЕНЬ) КАК Дата,
    Реализация.Контрагент,
    Реализация.ДоговорКонтрагента,
    Товары.НоменклатурнаяГруппа,
    0, 0, 0, 0,
    СУММА(ЕСТЬNULL(Услуги.Количество, Товары.Количество)) КАК КорректировкаКоличество,
    СУММА(ЕСТЬNULL(Услуги.Сумма, Товары.Сумма)) КАК КорректировкаСумма

ИЗ
    Документ.КорректировкаРеализации КАК К
    ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаРеализации.Товары КАК Товары
        ПО К.Ссылка = Товары.Ссылка
    ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаРеализации.Услуги КАК Услуги
        ПО К.Ссылка = Услуги.Ссылка
    ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК Реализация
        ПО К.ДокументРеализации = Реализация.Ссылка

ГДЕ
    К.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания

СГРУППИРОВАТЬ ПО
    НАЧАЛОПЕРИОДА(К.Дата, ДЕНЬ),
    Товары.НоменклатурнаяГруппа,
    Реализация.Контрагент,
    Реализация.ДоговорКонтрагента
