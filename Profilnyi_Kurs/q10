ВЫБРАТЬ
    Итог.Дата КАК Дата,
    Итог.Контрагент КАК Контрагент,
    Итог.ДоговорКонтрагента КАК ДоговорКонтрагента,
    Итог.НоменклатурнаяГруппа,
    Итог.Количество КАК Количество,
    Итог.Сумма КАК Сумма,
    Итог.СчетУчета КАК СчетУчета
ИЗ
(
    /////////////////////// ТОВАРЫ + УСЛУГИ //////////////////////
    ВЫБРАТЬ
        Товары.Дата,
        Товары.Контрагент,
        Товары.ДоговорКонтрагента,
        Товары.НоменклатурнаяГруппа,
        Товары.Количество,
        ЕСЛИ(Услуги.ОбщееКоличество = 0 ИЛИ Услуги.ОбщееКоличество ЕСТЬ NULL, 0, Услуги.ОбщаяСумма / Услуги.ОбщееКоличество * Товары.Количество) КАК Сумма,
        Товары.СчетУчета
    ИЗ
    (
        /////////////////////// ТОВАРЫ //////////////////////
        ВЫБРАТЬ
            Реализация.Дата КАК Дата,
            Реализация.Контрагент КАК Контрагент,
            Реализация.ДоговорКонтрагента КАК ДоговорКонтрагента,
            РТУТовары.Субконто КАК НоменклатурнаяГруппа,
            СУММА(РТУТовары.Количество) КАК Количество,
            СУММА(РТУТовары.Сумма) КАК Сумма,
            РТУТовары.СчетРасходов КАК СчетУчета
        ИЗ
            Документ.РеализацияТоваровУслуг КАК Реализация
                ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Товары КАК РТУТовары
                ПО Реализация.Ссылка = РТУТовары.Ссылка
        ГДЕ
            Реализация.Проведен
            И Реализация.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
            И Реализация.Склад.Наименование ПОДОБНО "%Склад отгрузки готовой продукции%"
            И СОКРЛ(СОКРП(Реализация.ПодразделениеОрганизации.Код)) = "53"
        СГРУППИРОВАТЬ ПО
            Реализация.Контрагент,
            Реализация.ДоговорКонтрагента,
            Реализация.Дата,
            РТУТовары.Субконто,
            РТУТовары.СчетРасходов
    ) КАК Товары
    ЛЕВОЕ СОЕДИНЕНИЕ
    (
        /////////////////////// УСЛУГИ //////////////////////
        ВЫБРАТЬ
            Реализация.Контрагент КАК Контрагент,
            Реализация.ДоговорКонтрагента КАК ДоговорКонтрагента,
            РТУУслуги.Субконто КАК НоменклатурнаяГруппа,
            СУММА(РТУУслуги.Сумма) КАК ОбщаяСумма,
            СУММА(РТУУслуги.Количество) КАК ОбщееКоличество
        ИЗ
            Документ.РеализацияТоваровУслуг КАК Реализация
                ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Услуги КАК РТУУслуги
                ПО Реализация.Ссылка = РТУУслуги.Ссылка
        ГДЕ
            Реализация.Проведен
            И Реализация.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
            И Реализация.Склад.Наименование ПОДОБНО "%Склад отгрузки готовой продукции%"
            И СОКРЛ(СОКРП(Реализация.ПодразделениеОрганизации.Код)) = "53"
        СГРУППИРОВАТЬ ПО
            Реализация.Контрагент,
            Реализация.ДоговорКонтрагента,
            РТУУслуги.Субконто
    ) КАК Услуги
    ПО
        Товары.Контрагент = Услуги.Контрагент
        И Товары.ДоговорКонтрагента = Услуги.ДоговорКонтрагента
        И Товары.НоменклатурнаяГруппа = Услуги.НоменклатурнаяГруппа

    ОБЪЕДИНИТЬ ВСЕ

    /////////////////////// ФАКТ //////////////////////
    ВЫБРАТЬ
        Факт.Период КАК Дата,
        Факт.Контрагент,
        Факт.ДоговорКонтрагента,
        Факт.НоменклатурнаяГруппа,
        СУММА(Факт.Количество) КАК Количество,
        СУММА(Факт.Сумма) КАК Сумма,
        0 КАК СчетУчета
    ИЗ
        Документ.бит_ПолучениеФактическихДанных.ФактическиеДанные КАК Факт
    ГДЕ
        Факт.Ссылка.Проведен
        И Факт.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
        И Факт.Ссылка.Сценарий.Наименование = "ФАКТ"
        И Факт.СтатьяОборотов.ТипСтатьи = ЗНАЧЕНИЕ(Перечисление.бит_ТипыСтатейОборотов.БДР)
        И Факт.СтатьяОборотов.Кодификатор ПОДОБНО "11.42.0[0-4][0-3]%"
    СГРУППИРОВАТЬ ПО
        Факт.ДоговорКонтрагента,
        Факт.Контрагент,
        Факт.НоменклатурнаяГруппа,
        Факт.Период
) КАК Итог
