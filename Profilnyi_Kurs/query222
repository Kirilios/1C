ВЫБРАТЬ
    НАЧАЛОПЕРИОДА(Данные.Дата, ДЕНЬ) КАК Дата,
    Данные.Контрагент,
    Данные.ДоговорКонтрагента,
    Данные.НоменклатурнаяГруппа,
    ЕСТЬNULL(Данные.РеализацияКоличество,0) КАК РеализацияКоличество,
    ЕСТЬNULL(Данные.РеализацияСумма,0) КАК РеализацияСумма,
    ЕСТЬNULL(Данные.ФактКоличество,0) КАК ФактКоличество,
    ЕСТЬNULL(Данные.ФактСумма,0) КАК ФактСумма,
    ЕСТЬNULL(Данные.КорректировкаКоличество,0) КАК КорректировкаКоличество,
    ЕСТЬNULL(Данные.КорректировкаСумма,0) КАК КорректировкаСумма
ИЗ
    (ВЫБРАТЬ
        Реализация.Дата КАК Дата,
        Реализация.Контрагент,
        Реализация.ДоговорКонтрагента,
        ВЫБОР
            КОГДА ЕСТЬNULL(РТУТовары.Субконто,0) <> 0 ТОГДА РТУТовары.Субконто
            ИНАЧЕ ЕСТЬNULL(РТУУслуг.Субконто,0)
        КОНЕЦ КАК НоменклатурнаяГруппа,
        СУММА(ЕСТЬNULL(РТУТовары.Количество,0) + ЕСТЬNULL(РТУУслуг.Количество,0)) КАК РеализацияКоличество,
        СУММА(ЕСТЬNULL(РТУТовары.Сумма,0) + ЕСТЬNULL(РТУУслуг.Сумма,0)) КАК РеализацияСумма,
        0 КАК ФактКоличество,
        0 КАК ФактСумма,
        0 КАК КорректировкаКоличество,
        0 КАК КорректировкаСумма
    ИЗ
        Документ.РеализацияТоваровУслуг КАК Реализация
        ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Товары КАК РТУТовары
            ПО Реализация.Ссылка = РТУТовары.Ссылка
        ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Услуги КАК РТУУслуг
            ПО Реализация.Ссылка = РТУУслуг.Ссылка
    ГДЕ
        Реализация.Проведен
        И Реализация.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
    СГРУППИРОВАТЬ ПО
        Реализация.Дата,
        Реализация.Контрагент,
        Реализация.ДоговорКонтрагента,
        ВЫБОР
            КОГДА ЕСТЬNULL(РТУТовары.Субконто,0) <> 0 ТОГДА РТУТовары.Субконто
            ИНАЧЕ ЕСТЬNULL(РТУУслуг.Субконто,0)
        КОНЕЦ

    ОБЪЕДИНИТЬ ВСЕ

    ВЫБРАТЬ
        Факт.Период КАК Дата,
        Факт.Контрагент,
        Факт.ДоговорКонтрагента,
        ЕСТЬNULL(Факт.НоменклатурнаяГруппа,0) КАК НоменклатурнаяГруппа,
        0 КАК РеализацияКоличество,
        0 КАК РеализацияСумма,
        СУММА(Факт.Количество) КАК ФактКоличество,
        СУММА(Факт.Сумма) КАК ФактСумма,
        0 КАК КорректировкаКоличество,
        0 КАК КорректировкаСумма
    ИЗ
        Документ.бит_ПолучениеФактическихДанных.ФактическиеДанные КАК Факт
    ГДЕ
        Факт.Ссылка.Проведен
        И Факт.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
        И Факт.Ссылка.Сценарий.Наименование = "ФАКТ"
    СГРУППИРОВАТЬ ПО
        Факт.Период,
        Факт.Контрагент,
        Факт.ДоговорКонтрагента,
        Факт.НоменклатурнаяГруппа

    ОБЪЕДИНИТЬ ВСЕ

    ВЫБРАТЬ
        Корректировка.Дата КАК Дата,
        Реализация.Контрагент,
        Реализация.ДоговорКонтрагента,
        ВЫБОР
            КОГДА ЕСТЬNULL(КоррТовары.Субконто,0) <> 0 ТОГДА КоррТовары.Субконто
            ИНАЧЕ 0
        КОНЕЦ КАК НоменклатурнаяГруппа,
        0 КАК РеализацияКоличество,
        0 КАК РеализацияСумма,
        0 КАК ФактКоличество,
        0 КАК ФактСумма,
        СУММА(ЕСТЬNULL(КоррТовары.Количество,0) + ЕСТЬNULL(КоррУслуги.Количество,0)) КАК КорректировкаКоличество,
        СУММА(ЕСТЬNULL(КоррТовары.Сумма,0) + ЕСТЬNULL(КоррУслуги.Сумма,0)) КАК КорректировкаСумма
    ИЗ
        Документ.КорректировкаРеализации КАК Корректировка
        ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаРеализации.Товары КАК КоррТовары
            ПО Корректировка.Ссылка = КоррТовары.Ссылка
        ЛЕВОЕ СОЕДИНЕНИЕ Документ.КорректировкаРеализации.Услуги КАК КоррУслуги
            ПО Корректировка.Ссылка = КоррУслуги.Ссылка
        ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК Реализация
            ПО Корректировка.ДокументРеализации = Реализация.Ссылка
    ГДЕ
        Корректировка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
    СГРУППИРОВАТЬ ПО
        Корректировка.Дата,
        Реализация.Контрагент,
        Реализация.ДоговорКонтрагента,
        ВЫБОР
            КОГДА ЕСТЬNULL(КоррТовары.Субконто,0) <> 0 ТОГДА КоррТовары.Субконто
            ИНАЧЕ 0
        КОНЕЦ
    ) КАК Данные

УПОРЯДОЧИТЬ ПО
    Дата,
    Контрагент,
    ДоговорКонтрагента,
    НоменклатурнаяГруппа
