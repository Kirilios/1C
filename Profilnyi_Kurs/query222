////////////////////////////////////////////////////////////////////////////////
// 1. Реализация с суммированием Товары + Услуги
////////////////////////////////////////////////////////////////////////////////
ВЫБРАТЬ
    НАЧАЛОПЕРИОДА(Реализация.Дата, ДЕНЬ) КАК Дата,
    Реализация.Контрагент КАК Контрагент,
    Реализация.ДоговорКонтрагента КАК ДоговорКонтрагента,
    ЕСТЬNULL(РТУТовары.НоменклатурнаяГруппа, ЕСТЬNULL(РТУУслуг.НоменклатурнаяГруппа, 0)) КАК НоменклатурнаяГруппа,
    ЕСТЬNULL(РТУТовары.Количество,0) + ЕСТЬNULL(РТУУслуг.Количество,0) КАК РеализацияКоличество,
    ЕСТЬNULL(РТУТовары.Сумма,0) + ЕСТЬNULL(РТУУслуг.Сумма,0) КАК РеализацияСумма,
    0 КАК ФактКоличество,
    0 КАК ФактСумма,
    0 КАК КорректировкаКоличество,
    0 КАК КорректировкаСумма
ИЗ
    Документ.РеализацияТоваровУслуг КАК Реализация
    ЛЕВОЕ СОЕДИНЕНИЕ
        (ВЫБРАТЬ
            Ссылка,
            СУММА(Количество) КАК Количество,
            СУММА(Сумма) КАК Сумма,
            Субконто КАК НоменклатурнаяГруппа
         ИЗ Документ.РеализацияТоваровУслуг.Товары
         СГРУППИРОВАТЬ ПО Ссылка, Субконто) КАК РТУТовары
        ПО Реализация.Ссылка = РТУТовары.Ссылка
    ЛЕВОЕ СОЕДИНЕНИЕ
        (ВЫБРАТЬ
            Ссылка,
            СУММА(Количество) КАК Количество,
            СУММА(Сумма) КАК Сумма,
            Субконто КАК НоменклатурнаяГруппа
         ИЗ Документ.РеализацияТоваровУслуг.Услуги
         СГРУППИРОВАТЬ ПО Ссылка, Субконто) КАК РТУУслуг
        ПО Реализация.Ссылка = РТУУслуг.Ссылка
ГДЕ
    Реализация.Проведен
    И Реализация.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
    И Реализация.Склад.Наименование ПОДОБНО "%Склад отгрузки готовой продукции%"
    И СОКРЛ(СОКРП(Реализация.ПодразделениеОрганизации.Код)) = "53"

////////////////////////////////////////////////////////////////////////////////
// 2. Фактические данные
////////////////////////////////////////////////////////////////////////////////
ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
    НАЧАЛОПЕРИОДА(Факт.Дата, ДЕНЬ) КАК Дата,
    Факт.Контрагент,
    Факт.ДоговорКонтрагента,
    ЕСТЬNULL(Факт.НоменклатурнаяГруппа,0) КАК НоменклатурнаяГруппа,
    0 КАК РеализацияКоличество,
    0 КАК РеализацияСумма,
    ЕСТЬNULL(Факт.ФактКоличество,0) КАК ФактКоличество,
    ЕСТЬNULL(Факт.ФактСумма,0) КАК ФактСумма,
    0 КАК КорректировкаКоличество,
    0 КАК КорректировкаСумма
ИЗ
    (ВЫБРАТЬ
        Период КАК Дата,
        Контрагент,
        ДоговорКонтрагента,
        НоменклатурнаяГруппа,
        СУММА(Количество) КАК ФактКоличество,
        СУММА(Сумма) КАК ФактСумма
     ИЗ Документ.бит_ПолучениеФактическихДанных.ФактическиеДанные
     ГДЕ
         Ссылка.Проведен
         И Период МЕЖДУ &ДатаНачала И &ДатаОкончания
         И Ссылка.Сценарий.Наименование = "ФАКТ"
         И СтатьяОборотов.ТипСтатьи = ЗНАЧЕНИЕ(Перечисление.бит_ТипыСтатейОборотов.БДР)
         И (СтатьяОборотов.Кодификатор ПОДОБНО "11.42.00[1-9]%"
             ИЛИ СтатьяОборотов.Кодификатор ПОДОБНО "11.42.0[1-3][0-9]%"
             ИЛИ СтатьяОборотов.Кодификатор ПОДОБНО "11.42.04[0-3]%")
     СГРУППИРОВАТЬ ПО Период, Контрагент, ДоговорКонтрагента, НоменклатурнаяГруппа) КАК Факт

////////////////////////////////////////////////////////////////////////////////
// 3. Корректировка реализации
////////////////////////////////////////////////////////////////////////////////
ОБЪЕДИНИТЬ ВСЕ

ВЫБРАТЬ
    НАЧАЛОПЕРИОДА(Корректировка.Дата, ДЕНЬ) КАК Дата,
    ЕСТЬNULL(Реализация.Контрагент,0) КАК Контрагент,
    ЕСТЬNULL(Реализация.ДоговорКонтрагента,0) КАК ДоговорКонтрагента,
    ЕСТЬNULL(КоррТовары.НоменклатурнаяГруппа,0) КАК НоменклатурнаяГруппа,
    0 КАК РеализацияКоличество,
    0 КАК РеализацияСумма,
    0 КАК ФактКоличество,
    0 КАК ФактСумма,
    ЕСТЬNULL(КоррТовары.Количество,0) + ЕСТЬNULL(КоррУслуги.Количество,0) КАК КорректировкаКоличество,
    ЕСТЬNULL(КоррТовары.Сумма,0) + ЕСТЬNULL(КоррУслуги.Сумма,0) КАК КорректировкаСумма
ИЗ
    Документ.КорректировкаРеализации КАК Корректировка
    ЛЕВОЕ СОЕДИНЕНИЕ
        (ВЫБРАТЬ
            Ссылка,
            СУММА(Количество) КАК Количество,
            СУММА(Сумма) КАК Сумма,
            Субконто КАК НоменклатурнаяГруппа
         ИЗ Документ.КорректировкаРеализации.Товары
         СГРУППИРОВАТЬ ПО Ссылка, Субконто) КАК КоррТовары
        ПО Корректировка.Ссылка = КоррТовары.Ссылка
    ЛЕВОЕ СОЕДИНЕНИЕ
        (ВЫБРАТЬ
            Ссылка,
            СУММА(Количество) КАК Количество,
            СУММА(Сумма) КАК Сумма
         ИЗ Документ.КорректировкаРеализации.Услуги
         СГРУППИРОВАТЬ ПО Ссылка) КАК КоррУслуги
        ПО Корректировка.Ссылка = КоррУслуги.Ссылка
    ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК Реализация
        ПО Корректировка.ДокументРеализации = Реализация.Ссылка
ГДЕ
    Корректировка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания

УПОРЯДОЧИТЬ ПО
    Дата,
    Контрагент,
    ДоговорКонтрагента,
    НоменклатурнаяГруппа
