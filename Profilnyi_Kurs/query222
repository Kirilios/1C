// --- Реализация + Факт ---
ВЫБРАТЬ
    НАЧАЛОПЕРИОДА(Реализация.Дата, ДЕНЬ) КАК Дата,
    Реализация.Контрагент КАК Контрагент,
    Реализация.ДоговорКонтрагента КАК ДоговорКонтрагента,
    ЕСТЬNULL(РТУТовары.Субконто, ЕСТЬNULL(РТУУслуг.Субконто, 0)) КАК НоменклатурнаяГруппа,
    СУММА(
        ВЫБОР
            КОГДА СУММА(ЕСТЬNULL(РТУТовары.Сумма,0)) > 0 ТОГДА СУММА(ЕСТЬNULL(РТУТовары.Количество,0))
            ИНАЧЕ 0
        КОНЕЦ +
        СУММА(ЕСТЬNULL(РТУУслуг.Количество,0))
    ) КАК РеализацияКоличество,
    СУММА(ЕСТЬNULL(РТУТовары.Сумма,0) + ЕСТЬNULL(РТУУслуг.Сумма,0)) КАК РеализацияСумма,
    СУММА(ЕСТЬNULL(Факт.ФактКоличество,0)) КАК ФактКоличество,
    СУММА(ЕСТЬNULL(Факт.ФактСумма,0)) КАК ФактСумма,
    0 КАК КорректировкаКоличество,
    0 КАК КорректировкаСумма
ИЗ
    Документ.РеализацияТоваровУслуг КАК Реализация
    ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Товары КАК РТУТовары
        ПО Реализация.Ссылка = РТУТовары.Ссылка
    ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Услуги КАК РТУУслуг
        ПО Реализация.Ссылка = РТУУслуг.Ссылка
    ЛЕВОЕ СОЕДИНЕНИЕ (
        ВЫБРАТЬ
            НАЧАЛОПЕРИОДА(ФактическиеДанные.Период, ДЕНЬ) КАК Дата,
            ФактическиеДанные.Контрагент,
            ФактическиеДанные.ДоговорКонтрагента,
            ФактическиеДанные.НоменклатурнаяГруппа,
            СУММА(ФактическиеДанные.Количество) КАК ФактКоличество,
            СУММА(ФактическиеДанные.Сумма) КАК ФактСумма
        ИЗ
            Документ.бит_ПолучениеФактическихДанных.ФактическиеДанные КАК ФактическиеДанные
        ГДЕ
            ФактическиеДанные.Ссылка.Проведен
            И ФактическиеДанные.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
        СГРУППИРОВАТЬ ПО
            НАЧАЛОПЕРИОДА(ФактическиеДанные.Период, ДЕНЬ),
            ФактическиеДанные.Контрагент,
            ФактическиеДанные.ДоговорКонтрагента,
            ФактическиеДанные.НоменклатурнаяГруппа
    ) КАК Факт
        ПО НАЧАЛОПЕРИОДА(Реализация.Дата, ДЕНЬ) = Факт.Дата
        И Реализация.Контрагент = Факт.Контрагент
        И Реализация.ДоговорКонтрагента = Факт.ДоговорКонтрагента
        И ЕСТЬNULL(РТУТовары.Субконто, ЕСТЬNULL(РТУУслуг.Субконто, 0)) = Факт.НоменклатурнаяГруппа

СГРУППИРОВАТЬ ПО
    НАЧАЛОПЕРИОДА(Реализация.Дата, ДЕНЬ),
    Реализация.Контрагент,
    Реализация.ДоговорКонтрагента,
    ЕСТЬNULL(РТУТовары.Субконто, ЕСТЬNULL(РТУУслуг.Субконто, 0))

ОБЪЕДИНИТЬ ВСЕ

// --- Корректировка ---
ВЫБРАТЬ
    НАЧАЛОПЕРИОДА(Корректировка.Дата, ДЕНЬ) КАК Дата,
    Реализация.Контрагент КАК Контрагент,
    Реализация.ДоговорКонтрагента КАК ДоговорКонтрагента,
    ЕСТЬNULL(КоррТовары.Субконто, 0) КАК НоменклатурнаяГруппа,
    0 КАК РеализацияКоличество,
    0 КАК РеализацияСумма,
    0 КАК ФактКоличество,
    0 КАК ФактСумма,
    СУММА(
        ВЫБОР
            КОГДА СУММА(КоррУслуги.Количество) > 0 ТОГДА СУММА(КоррУслуги.Количество)
            ИНАЧЕ СУММА(КоррТовары.Количество)
        КОНЕЦ
    ) КАК КорректировкаКоличество,
    СУММА(
        ВЫБОР
            КОГДА СУММА(КоррУслуги.Сумма) > 0 ТОГДА СУММА(КоррУслуги.Сумма)
            ИНАЧЕ СУММА(КоррТовары.Сумма)
        КОНЕЦ
    ) КАК КорректировкаСумма
ИЗ
    Документ.КорректировкаРеализации КАК Корректировка
    ЛЕВОЕ СОЕДИНЕНИЕ (
        ВЫБРАТЬ
            Товары.Ссылка КАК Ссылка,
            Товары.Субконто,
            СУММА(Товары.Количество) КАК Количество,
            СУММА(Товары.Сумма) КАК Сумма
        ИЗ Документ.КорректировкаРеализации.Товары КАК Товары
        СГРУППИРОВАТЬ ПО
            Товары.Ссылка,
            Товары.Субконто
    ) КАК КоррТовары
        ПО Корректировка.Ссылка = КоррТовары.Ссылка

    ЛЕВОЕ СОЕДИНЕНИЕ (
        ВЫБРАТЬ
            Услуги.Ссылка КАК Ссылка,
            СУММА(Услуги.Количество) КАК Количество,
            СУММА(Услуги.Сумма) КАК Сумма
        ИЗ Документ.КорректировкаРеализации.Услуги КАК Услуги
        СГРУППИРОВАТЬ ПО
            Услуги.Ссылка
    ) КАК КоррУслуги
        ПО Корректировка.Ссылка = КоррУслуги.Ссылка

    ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг КАК Реализация
        ПО Корректировка.ДокументРеализации = Реализация.Ссылка

ГДЕ
    Корректировка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания

СГРУППИРОВАТЬ ПО
    НАЧАЛОПЕРИОДА(Корректировка.Дата, ДЕНЬ),
    ЕСТЬNULL(КоррТовары.Субконто, 0),
    Реализация.Контрагент,
    Реализация.ДоговорКонтрагента

УПОРЯДОЧИТЬ ПО
    Дата,
    Контрагент,
    ДоговорКонтрагента
