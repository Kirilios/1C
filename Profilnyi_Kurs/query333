ВЫБРАТЬ
    Данные.Дата,
    Данные.Контрагент,
    Данные.ДоговорКонтрагента,
    Данные.НоменклатурнаяГруппа,
    Данные.Количество,
    Данные.Сумма,
    Данные.СчетУчета
ИЗ
(
    ВЫБРАТЬ
        ЗапросНомер,
        Дата,
        Контрагент,
        ДоговорКонтрагента,
        НоменклатурнаяГруппа,
        Количество,
        Сумма,
        СчетУчета
    ИЗ
        (  
            // --- 1. ТОВАРЫ ---
            ВЫБРАТЬ
                1 КАК ЗапросНомер,
                Реализация.Дата,
                Реализация.Контрагент,
                Реализация.ДоговорКонтрагента,
                РТУТовары.Субконто КАК НоменклатурнаяГруппа,
                РТУТовары.Количество,
                РТУТовары.Сумма,
                РТУТовары.СчетРасходов КАК СчетУчета
            ИЗ
                Документ.РеализацияТоваровУслуг КАК Реализация
                    ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Товары КАК РТУТовары
                    ПО Реализация.Ссылка = РТУТовары.Ссылка
            ГДЕ
                Реализация.Проведен
                И Реализация.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
                И Реализация.Склад.Наименование ПОДОБНО "%Склад отгрузки готовой продукции%"
                И СОКРЛ(СОКРП(Реализация.ПодразделениеОрганизации.Код)) = "53"

            ОБЪЕДИНИТЬ ВСЕ

            // --- 2. УСЛУГИ ---
            ВЫБРАТЬ
                2,
                Реализация.Дата,
                Реализация.Контрагент,
                Реализация.ДоговорКонтрагента,
                РТУУслуги.Субконто,
                РТУУслуги.Количество,
                РТУУслуги.Сумма,
                NULL
            ИЗ
                Документ.РеализацияТоваровУслуг КАК Реализация
                    ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Услуги КАК РТУУслуги
                    ПО Реализация.Ссылка = РТУУслуги.Ссылка
            ГДЕ
                Реализация.Проведен
                И Реализация.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
                И Реализация.Склад.Наименование ПОДОБНО "%Склад отгрузки готовой продукции%"
                И СОКРЛ(СОКРП(Реализация.ПодразделениеОрганизации.Код)) = "53"

            ОБЪЕДИНИТЬ ВСЕ

            // --- 3. ФАКТ ---
            ВЫБРАТЬ
                3,
                ФактическиеДанные.Период,
                ФактическиеДанные.Контрагент,
                ФактическиеДанные.ДоговорКонтрагента,
                ФактическиеДанные.НоменклатурнаяГруппа,
                ФактическиеДанные.Количество,
                ФактическиеДанные.Сумма,
                NULL
            ИЗ
                Документ.бит_ПолучениеФактическихДанных.ФактическиеДанные КАК ФактическиеДанные
            ГДЕ
                ФактическиеДанные.Ссылка.Проведен
                И ФактическиеДанные.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
                И ФактическиеДанные.Ссылка.Сценарий.Наименование = "ФАКТ"
                И ФактическиеДанные.СтатьяОборотов.ТипСтатьи =
                    ЗНАЧЕНИЕ(Перечисление.бит_ТипыСтатейОборотов.БДР)
                И ФактическиеДанные.СтатьяОборотов.Кодификатор ПОДОБНО "11.42.0[0-4][0-3]%"
        ) КАК Сырые

) КАК Данные

СГРУППИРОВАТЬ ПО
    Данные.Дата,
    Данные.Контрагент,
    Данные.ДоговорКонтрагента,
    Данные.НоменклатурнаяГруппа

УПОРЯДОЧИТЬ ПО
    ЗапросНомер

ПЕРВЫЕ 1;
