ВЫБРАТЬ
    РеализацияАгр.Дата КАК Дата,
    РеализацияАгр.Контрагент,
    РеализацияАгр.ДоговорКонтрагента,
    РеализацияАгр.НоменклатурнаяГруппа,
    ЕСТЬNULL(РеализацияАгр.РеализацияКоличество,0) КАК РеализацияКоличество,
    ЕСТЬNULL(РеализацияАгр.РеализацияСумма,0) КАК РеализацияСумма,
    ЕСТЬNULL(ФактАгр.ФактКоличество,0) КАК ФактКоличество,
    ЕСТЬNULL(ФактАгр.ФактСумма,0) КАК ФактСумма
ИЗ
    (
        ВЫБРАТЬ
            Реализация.Дата,
            Реализация.Контрагент,
            Реализация.ДоговорКонтрагента,
            ЕСТЬNULL(РТУТовары.Субконто, РТУУслуг.Субконто) КАК НоменклатурнаяГруппа,
            СУММА(
                ВЫБОР
                    КОГДА ЕСТЬNULL(РТУТовары.Сумма,0) > 0 ТОГДА ЕСТЬNULL(РТУТовары.Количество,0) ИНАЧЕ 0 КОНЕЦ
                +
                ЕСТЬNULL(РТУУслуг.Количество,0)
            ) КАК РеализацияКоличество,
            СУММА(ЕСТЬNULL(РТУТовары.Сумма,0)+ЕСТЬNULL(РТУУслуг.Сумма,0)) КАК РеализацияСумма
        ИЗ
            Документ.РеализацияТоваровУслуг КАК Реализация
                ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Товары КАК РТУТовары
                    ПО Реализация.Ссылка = РТУТовары.Ссылка
                ЛЕВОЕ СОЕДИНЕНИЕ Документ.РеализацияТоваровУслуг.Услуги КАК РТУУслуг
                    ПО Реализация.Ссылка = РТУУслуг.Ссылка
        ГДЕ
            Реализация.Проведен
            И Реализация.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
            И Реализация.Склад.Наименование ПОДОБНО "%Склад отгрузки готовой продукции%"
            И СОКРЛ(СОКРП(Реализация.ПодразделениеОрганизации.Код)) = "53"
        СГРУППИРОВАТЬ ПО
            Реализация.Дата,
            Реализация.Контрагент,
            Реализация.ДоговорКонтрагента,
            ЕСТЬNULL(РТУТовары.Субконто, РТУУслуг.Субконто)
    ) КАК РеализацияАгр
    ЛЕВОЕ СОЕДИНЕНИЕ
    (
        ВЫБРАТЬ
            ФактическиеДанные.Период КАК Дата,
            ФактическиеДанные.Контрагент,
            ФактическиеДанные.ДоговорКонтрагента,
            ФактическиеДанные.НоменклатурнаяГруппа,
            СУММА(ФактическиеДанные.Количество) КАК ФактКоличество,
            СУММА(ФактическиеДанные.Сумма) КАК ФактСумма
        ИЗ
            Документ.бит_ПолучениеФактическихДанных.ФактическиеДанные КАК ФактическиеДанные
        ГДЕ
            ФактическиеДанные.Ссылка.Проведен
            И ФактическиеДанные.Период МЕЖДУ &ДатаНачала И &ДатаОкончания
            И ФактическиеДанные.Ссылка.Сценарий.Наименование = "ФАКТ"
            И ФактическиеДанные.СтатьяОборотов.ТипСтатьи = ЗНАЧЕНИЕ(Перечисление.бит_ТипыСтатейОборотов.БДР)
            И ФактическиеДанные.СтатьяОборотов.Кодификатор ПОДОБНО "11.42.0[0-4][0-3]%"
        СГРУППИРОВАТЬ ПО
            ФактическиеДанные.Период,
            ФактическиеДанные.Контрагент,
            ФактическиеДанные.ДоговорКонтрагента,
            ФактическиеДанные.НоменклатурнаяГруппа
    ) КАК ФактАгр
    ПО
        РеализацияАгр.Дата = ФактАгр.Дата
        И РеализацияАгр.Контрагент = ФактАгр.Контрагент
        И РеализацияАгр.ДоговорКонтрагента = ФактАгр.ДоговорКонтрагента
        И РеализацияАгр.НоменклатурнаяГруппа = ФактАгр.НоменклатурнаяГруппа
